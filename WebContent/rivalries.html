<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>

    <link rel="stylesheet" href="styles/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/d3.slider.css">


</head>

<body>


<script type="text/javascript" src="d3/d3.min.js"></script>
<script type="text/javascript" src="d3Functions.js"></script>
<script type="text/javascript" src="js/d3slider/d3.slider.js"></script>
<div class="sexyMainDiv">
    <select id="teamSelector" class="dropdown-menu-left">
        <option> "Adelaide Thunderbirds"</option>
        <option> "Melbourne Vixens"</option>
        <option> "Central Pulse"</option>
        <option> "Queensland Firebirds"</option>
        <option> "Waikato Bay of Plenty Magic"</option>
        <option> "Southern Steel"</option>
        <option> "New South Wales Swifts"</option>
        <option> "Northern Mystics"</option>
        <option> "West Coast Fever"</option>
        <option> "Canterbury Tactix"</option>
    </select>

    <table>
        <tr>
            <td></td>
            <td id="barSvgCell">
                <script type="text/javascript">

                    var width = 800;
                    var height = 700;

                    function stripQuotes(str) {
                        var s = str.replace(/\"/g, '');
                        return s;
                    }
                    var teamNames = [
                        "Adelaide Thunderbirds",
                        "Central Pulse" ,
                        "Canterbury Tactix",
                        "Melbourne Vixens",
                        "New South Wales Swifts",
                        "Northern Mystics",
                        "Queensland Firebirds",
                        "Southern Steel",
                        "Waikato Bay of Plenty Magic",
                        "West Coast Fever"
                    ];
                    var currTeam = stripQuotes(document.getElementById("teamSelector").options[0].value);
                    console.log("Initialised team = " + currTeam);
                    var offSet = 30;
                    var barWidth = 80;
                    var factor = 20;
                    var teamColors = [
                        {
                            AdelaideThunderbirdsRect: [
                                {'fill1': '#FF1493' /* Pink */, 'fill2': '#FFFFF1'/* White */}
                            ]

                        },
                        {
                            CentralPulseRect: [
                                {
                                    "fill1": "#FFFF00", /* Yellow */
                                    "fill2": "#1560BD" /* Blue */
                                }
                            ]
                        }
                        ,
                        {                            /*CANTERBURY TACTIX*/
                            CanterburyTactixRect: [
                                {
                                    "fill1": '#FF0000', /* Red */
                                    "fill2": '#000000'/* Black */
                                }
                            ]
                        },
                        {                            /* MELB VIX*/
                            MelbourneVixensRect: [
                                {
                                    "fill1": '#191970', /* Dark Blue */
                                    "fill2": '#008080'/* Green */
                                }
                            ]
                        },
                        {                            /*NSW SWIFTS*/
                            NewSouthWalesSwiftsRect: [
                                {
                                    "fill1": '#FF0000', /*Red*/
                                    "fill2": '#6495ED'/*Light Blue*/
                                }
                            ]
                        },
                        {                            /*NORTHERN MYSTICS*/
                            NorthernMysticsRect: [
                                {
                                    "fill1": '#0000FF', /* Royal Blue */
                                    "fill2": '#FF0000'/* Red */
                                }
                            ]
                        },
                        {                            /*QUEENSLAND FIREBIRDS*/
                            QueenslandFirebirdsRect: [
                                {
                                    "fill1": '#800080', /* Purple */
                                    "fill2": '#FFA500'/* Gold */
                                }
                            ]
                        },
                        {                            /*SOUTHERN STEEL*/
                            SouthernSteelRect: [
                                {
                                    "fill1": '#00B7EB', /* Light Blue*/
                                    "fill2": '#000000'/*Black*/
                                }
                            ]
                        },
                        {                            /*WAIKATO BAY OF PLENTY MAGIC*/
                            WaikatoBayofPlentyMagicRect: [
                                {
                                    "fill1": '#000000', /* Black */
                                    "fill2": '#FF4500'/* Orange */
                                }
                            ]
                        },
                        {                            /*WESTCOST FEVER*/
                            WestCoastFeverRect: [
                                {
                                    "fill1": '#000000', /* Black */
                                    "fill2": '#32CD32'/* Bright Ugly Green*/
                                }
                            ]}
                    ];
                    var svg = d3.select("#barSvgCell")
                            .append("svg")
                            .attr("width", width)
                            .attr("height", height);
                    var winContainer = svg.append("g");
    var force = d3.layout.force()
            .charge(-120)
            .linkDistance(30)
            .size([width,height]);

                    //MAIN BEGIN

                    d3.json("data/allSeasons.json", function (data) {
                        var forceGraph = getRivals(data);
                        //BEGIN FORCED
                        d3.json(forceGraph, function(json){
                            console.log(forceGraph);
                        });

                        //END FORCED
                        console.log("Helo");












                        //Selector
                        d3.select("#teamSelector").on("change", function () {
                            console.log("DOINGFUCKING CHANGE BULLSHIT");
                            var sel = document.getElementById("teamSelector");
                            var name = stripQuotes(sel.options[sel.selectedIndex].value);
                            currTeam = name;
                            console.log(currTeam);
                        });
                        ///Selecter


function getRivals(data) {

    var graph = {
        nodes:[

        ],
        links:[]
    };


var linkIdx = 0;
    for(team in teamNames){
        //Go through each team
        //create a node for each tea
        graph.nodes[team] = {"name":teamNames[team],"group":1};

//        for(var key in graph.nodes){
//            console.log(graph.nodes[key].name === teamNames[team]);
//        }
//        console.log( Object.keys(graph.nodes));

        for(team2 in teamNames){
            if(teamNames[team] !== teamNames[team2]){

                var teamWinLossLink = [];
                var year = +2008;
                var winCount = 0;
                var lossCount = 0;

                for (var i = 5; i >= 0; i--) {
                    var season = data["seasons"][0][year];
//                    console.log(year);
                    for (var x = season.length - 1; x >= 0; x--) {


                        if (season[x].winner === teamNames[team] && season[x].loser === teamNames[team2]) {

//                            console.log("MATcHED WIN");
//                            console.log("Winner"+""+season[x].winner + " Loser "+ season[x].loser);
                            winCount += 1;
//                            console.log("Wincount"+winCount)
                        }
                        else if (season[x].winner === teamNames[team2] && season[x].loser === teamNames[team]) {

//                            console.log("MATcHED LOSS");
//                            console.log("Winner"+""+season[x].winner + " Loser "+ season[x].loser);
                            lossCount += 1;
//                            console.log("Losscount"+lossCount)
                        }
                    }
                    year += 1;
                }

            }
            else{
                console.log("SAME SHIT DIFFERNET DAY")

            }
            console.log("TEam 1" + teamNames[team] +" Team 2"+teamNames[team2]);
            console.log("Wincount"+winCount)
            console.log("Losscount"+lossCount)
            if (lossCount === 0) {
                var linkStrength = winCount / (winCount + lossCount);
            } else {
                var linkStrength = lossCount / (winCount + lossCount);
            }
                    console.log("linkstrength"+linkStrength)

//            if(){
//
//            }
              graph.links[linkIdx] = {"source" : team, "target": team2, "value": linkStrength};

            winCount = 0;
            lossCount = 0;
            linkIdx+=1;


        }





        //for each other team
        //count up the number of games
        //calculate the winloss
        //theres a link to each other team
        //the value for the link is the ratio of win/loss




    }
    console.log("Helo");

var graphJson = JSON.stringify(graph);

    console.log("Helo");










return graphJson;

}
                    });
                    //END MAIN

                    function getIndex(name) {
                        return teamNames.indexOf(name);
                    }


                </script>
            </td>
            <td>
                <div id="gamesDiv">
                </div>
            </td>
        </tr>
    </table>
</div>
</body>
</html>