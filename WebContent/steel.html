<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>

    <link rel="stylesheet" href="styles/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/d3.slider.css">


</head>

<body>
<select id="teamSelector">
    <option> "Adelaide Thunderbirds"</option>
    <option> "Melbourne Vixens"</option>
    <option> "Central Pulse"</option>
    <option> "Queensland Firebirds"</option>
    <option> "Waikato Bay of Plenty Magic"</option>
    <option> "Southern Steel"</option>
    <option> "New South Wales Swifts"</option>
    <option> "Northern Mystics"</option>
    <option> "West Coast Fever"</option>
    <option> "Canterbury Tactix"</option>
</select>


<script type="text/javascript" src="d3/d3.min.js"></script>
<script type="text/javascript" src="d3Functions.js"></script>
<script type="text/javascript" src="js/d3slider/d3.slider.js"></script>
<table>
<tr>
<td></td>
<td id="barSvgCell">
<script type="text/javascript">

var width = 800;
var height = 500;

function stripQuotes(str) {
    var s = str.replace(/\"/g, '');
    return s;
}
var teamNames = [
    "Adelaide Thunderbirds",
    "Central Pulse" ,
    "Canterbury Tactix",
    "Melbourne Vixens",
    "New South Wales Swifts",
    "Northern Mystics",
    "Queensland Firebirds",
    "Southern Steel",
    "Waikato Bay of Plenty Magic",
    "West Coast Fever"
];
var currTeam = stripQuotes(document.getElementById("teamSelector").options[0].value);
console.log("Initialised team = " + currTeam);
var offSet = 30;
var barWidth = 80;
var factor = 20;
var teamColors = [
    {
        AdelaideThunderbirdsRect: [
            {'fill1': '#FF1493' /* Pink */, 'fill2': '#FFFFF1'/* White */}
        ]

    },
    {
        CentralPulseRect: [
            {
                "fill1": "#FFFF00", /* Yellow */
                "fill2": "#1560BD" /* Blue */
            }
        ]
    }
    ,
    {                            /*CANTERBURY TACTIX*/
        CanterburyTactixRect: [
            {
                "fill1": '#FF0000', /* Red */
                "fill2": '#000000'/* Black */
            }
        ]
    },
    {                            /* MELB VIX*/
        MelbourneVixensRect: [
            {
                "fill1": '#191970', /* Dark Blue */
                "fill2": '#008080'/* Green */
            }
        ]
    },
    {                            /*NSW SWIFTS*/
        NewSouthWalesSwiftsRect: [
            {
                "fill1": '#FF0000', /*Red*/
                "fill2": '#6495ED'/*Light Blue*/
            }
        ]
    },
    {                            /*NORTHERN MYSTICS*/
        NorthernMysticsRect: [
            {
                "fill1": '#0000FF', /* Royal Blue */
                "fill2": '#FF0000'/* Red */
            }
        ]
    },
    {                            /*QUEENSLAND FIREBIRDS*/
        QueenslandFirebirdsRect: [
            {
                "fill1": '#800080', /* Purple */
                "fill2": '#FFA500'/* Gold */
            }
        ]
    },
    {                            /*SOUTHERN STEEL*/
        SouthernSteelRect: [
            {
                "fill1": '#00B7EB', /* Light Blue*/
                "fill2": '#000000'/*Black*/
            }
        ]
    },
    {                            /*WAIKATO BAY OF PLENTY MAGIC*/
        WaikatoBayofPlentyMagicRect: [
            {
                "fill1": '#000000', /* Black */
                "fill2": '#FF4500'/* Orange */
            }
        ]
    },
    {                            /*WESTCOST FEVER*/
        WestCoastFeverRect: [
            {
                "fill1": '#000000', /* Black */
                "fill2": '#32CD32'/* Bright Ugly Green*/
            }
        ]}
];
var colorScale = d3.scale.ordinal()
        .domain(0, 1)
        .range(["#000000", "#32CD32"]);


var svg = d3.select("#barSvgCell")
        .append("svg")
        .attr("width", width)
        .attr("height", height);
var winContainer = svg.append("g");
var lossContainer = svg.append("g");
var textContainer = svg.append("g");

//

    d3.json("data/allSeasons.json", function (data) {



      var  dataSet = getSeasonOutComes(data);


         winContainer.selectAll("rect")
                .data(dataSet)
                .enter()
                .append("rect")
//                .filter(function (d) {
//                    return d.team == currTeam;
//                })
                .on("click", function (d) {
                    return showGames(data, "Win", d.year);
                })
                .attr("width", barWidth)
                .attr("height", function (d) {
                    return d.wincount * factor;
                })
                .attr("x", function (d, i) {
                    return 200 + (i * barWidth) + offSet;
                })
                .attr("y", function (d) {
                    return ((height) - d.wincount * factor);
                })

                .attr("fill", function (d, i) {
                    var idx = getIndex(d.team);
                    var color = stripSpaces(d.team, "Rect");
                    var fillVal = teamColors[idx][color][0]["fill1"];
                    return fillVal;
                })
                .attr("stroke-width", 1)
                .attr("stroke", "#000000")
                .append("title").text(function (d) {
                    return "Won : " + d.wincount;
                });



       lossContainer.selectAll("rect")
                .data(dataSet)
                .enter()
                .append("rect")
//                .filter(function (d) {
//                    return d.team == currTeam;
//                })
                .on("click", function (d) {
                    return showGames(data, "Loss", d.year);
                })
                .attr("width", barWidth)
                .attr("height", function (d) {

                    return d.losscount * factor;
                })
                .attr("x", function (d, i) {
                    return 200 + (i * barWidth) + offSet;
                })
                .attr("y", function (d) {
                    return ((height) - d.losscount * factor) - d.wincount * factor;
                })
                .attr("fill", function (d) {
                    var idx = getIndex(d.team);

                    var color = stripSpaces(d.team, "Rect");

                    var fillVal = teamColors[idx][color][0]["fill2"];
                    return fillVal;
                })

                .attr("stroke-width", 1)
                .attr("stroke", "#000000")
                .append("title").text(function (d) {
                    return "Lost : " + d.losscount;
                });


      textContainer.selectAll("text")
                .data(dataSet)
                .enter()
                .append("text")
//                .filter(function (d) {
//                    return d.team == currTeam;
//                })
                .text(function (d) {
                    return d.year;
                })
                .attr("x", function (d, i) {
                    return 200 + (i * barWidth) + offSet + (barWidth / 2);
                })
                .attr("y", function (d) {
                    return ((height) - d.losscount * factor) - d.wincount * factor - 20;
                })
                .attr("font-family", "verdana")
                .attr("text-anchor", "middle");


        function getSeasonOutComes(dataSet) {
            var seasonWinLoss = [];
            var year = +2008;
            var winCount = 0;
            var lossCount = 0;

                for (var i = 5; i >= 0; i--) {
                    var season = data["seasons"][0][year];
                    for (var x = season.length - 1; x >= 0; x--) {
                        if (season[x].winner === currTeam) {
                            winCount += 1;
                        }
                        else if (season[x].loser === currTeam) {
                            lossCount += 1;
                        }
                    }
                    var seasonOutCome = {
                        "team": currTeam, "year": year, "winlabel": "Won", "wincount": winCount, "lostlabel": "Lost", "losscount": lossCount
                    };
                    seasonWinLoss.push(seasonOutCome);
                    year += 1;
                    winCount = 0;
                    lossCount = 0;

                }


            return seasonWinLoss;
        }

        function showGames(infoSet, winLoss, seasonYear) {

            var games = [];
            var season = infoSet["seasons"][0][seasonYear];
            for (var x = season.length - 1; x >= 0; x--) {
                if (winLoss === "Win") {
                    if (season[x].winner === currTeam) {
                        games.push(season[x]);
                    }
                }
                else {
                    if (season[x].loser === currTeam) {
                        games.push(season[x]);
                    }
                }
            }

            d3.select("#gamesDiv").select("svg").selectAll("circle").remove();
            d3.select("#gamesDiv").selectAll("svg").remove();
            var gamesSvg = d3.select("#gamesDiv")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);
            var thisTeam = gamesSvg.append("g");
            var opponent = gamesSvg.append("g");
            for (var x = games.length - 1; x >= 0; x--) {


                var thisTeamResult = thisTeam.selectAll("circle")
                        .data(games)
                        .enter()
                        .append("circle")
                        .attr("cx", width / 4)
                        .attr("cy", (height / games.length) * x + offSet)
                        .attr("r", function (d) {
                            return 20;
                        })
                        .attr("class", function (d) {
                            var team = currTeam;

                            return stripSpaces(team, "Circle");
                        });

                var oppTeamResult = opponent.selectAll("circle")
                        .data(games)
                        .enter()
                        .append("circle")
                        .attr("cx", (width / 4) * 3)
                        .attr("cy", (height / games.length) * x + offSet)
                        .attr("r", function (d) {
                            return 20;
                        })
                        .attr("class", function (d) {
                            var team = "";
                            if (d.winner !== currTeam) {
                                team = d.winner;
                            }
                            else {
                                team = d.loser;
                            }
                            return stripSpaces(team, "Circle");
                        });


            }


        }
        d3.select("#teamSelector").on("change", function(){
console.log("DOINGFUCKING CHANGE BULLSHIT");
            var sel = document.getElementById("teamSelector");
            var name = stripQuotes(sel.options[sel.selectedIndex].value);
            currTeam = name;
            console.log(currTeam);
       var newDataSet =getSeasonOutComes(data);

        winContainer.selectAll("rect")
                    .data(newDataSet)
                    .transition()
                    .attr("width", barWidth)
                    .attr("height", function (d) {
                        return d.wincount * factor;
                    })
                    .attr("x", function (d, i) {
                        return 200 + (i * barWidth) + offSet;
                    })
                    .attr("y", function (d) {
                        return ((height) - d.wincount * factor);
                    })

                    .attr("fill", function (d, i) {
                        var idx = getIndex(d.team);
                        var color = stripSpaces(d.team, "Rect");

                        var fillVal = teamColors[idx][color][0]["fill1"];
                        return fillVal;
                    })
                    .attr("stroke-width", 1)
                    .attr("stroke", "#000000")
                    .append("title").text(function (d) {
                        return "Won : " + d.wincount;
                    });


            lossContainer.selectAll("rect")
                    .data(newDataSet)
                    .transition()
//                    .on("click", function (d) {
//                        return showGames(data, "Loss", d.year);
//                    })
                    .attr("width", barWidth)
                    .attr("height", function (d) {

                        return d.losscount * factor;
                    })
                    .attr("x", function (d, i) {
                        return 200 + (i * barWidth) + offSet;
                    })
                    .attr("y", function (d) {
                        return ((height) - d.losscount * factor) - d.wincount * factor;
                    })
                    .attr("fill", function (d) {
                        var idx = getIndex(d.team);
                        var color = stripSpaces(d.team, "Rect");
                        var fillVal = teamColors[idx][color][0]["fill2"];
                        return fillVal;
                    })

                    .attr("stroke-width", 1)
                    .attr("stroke", "#000000")
                    .attr("title").text(function (d) {
                        return "Lost : " + d.losscount;
                    });

            textContainer.selectAll("text")
                    .data(newDataSet)
                    .text(function (d) {
                        return d.year;
                    })
                    .attr("x", function (d, i) {
                        return 200 + (i * barWidth) + offSet + (barWidth / 2);
                    })
                    .attr("y", function (d) {
                        return ((height) - d.losscount * factor) - d.wincount * factor - 20;
                    })
                    .attr("font-family", "verdana")
                    .attr("text-anchor", "middle");

        });

    });
    function getIndex(name) {
        return teamNames.indexOf(name);
    }




//function setTeamName() {
//    var sel = document.getElementById("teamSelector");
//    var name = stripQuotes(sel.options[sel.selectedIndex].value);
//    currTeam = name;
//    console.log(name);
//    visualise();
//
//
//}

</script>
</td>
<td>
    <div id="gamesDiv">

    </div>
</td>
</tr>
</table>
</body>
</html>