<!DOCTYPE html>
<html>
<meta charset="utf-8"> 
<head>

<link rel="stylesheet" href="styles/bootstrap/dist/css/bootstrap.css">
<link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/d3.slider.css">


</head>

<body>
<script type="text/javascript" src="d3/d3.min.js"></script> 
<script type="text/javascript" src="node_modules/topojson/topojson.min.js"></script>
<script type="text/javascript" src="d3Functions.js"></script>
<script type="text/javascript" src="js/d3slider/d3.slider.js"></script>
<table class="mainDiv">
    <tr >
        <td>

        </td>

    </tr>
    <tr>

        <td>
            <select id="teamSelector">
                <option> "Adelaide Thunderbirds"</option>
                <option> "Melbourne Vixens"</option>
                <option> "Central Pulse"</option>
                <option> "Queensland Firebirds"</option>
                <option> "Waikato Bay of Plenty Magic"</option>
                <option> "Southern Steel"</option>
                <option> "New South Wales Swifts"</option>
                <option> "Northern Mystics"</option>
                <option> "West Coast Fever"</option>
                <option> "Canterbury Tactix"</option>
            </select>
            <select id="teamVSSelector">
                <option> "Adelaide Thunderbirds"</option>
                <option> "Melbourne Vixens"</option>
                <option> "Central Pulse"</option>
                <option> "Queensland Firebirds"</option>
                <option> "Waikato Bay of Plenty Magic"</option>
                <option> "Southern Steel"</option>
                <option> "New South Wales Swifts"</option>
                <option> "Northern Mystics"</option>
                <option> "West Coast Fever"</option>
                <option> "Canterbury Tactix"</option>
            </select>

        </td>
    </tr>
    <tr>
        <td id="svgCell1"></td>
        <div id="slider1" class="wrapper"></div>
    </tr>
    <tr>

    </tr>
</table>
<script type="text/javascript">

    var width = 600;
    var height = 700;
    var pieInnerRadius = 50;
    var pieRadius = 250;
    var margins = [{"top":(height/3)},{"left":500},{"bottom":0},{"right":50}];
    var baseTransX= 300;
var feverTeamName = "West Coast Fever";
var colorScale = d3.scale.ordinal()
					.domain(0,1)
					.range(["#000000","#32CD32"]);
var year = 2008;
 var teamColors = [
        {
            AdelaideThunderbirdsRect: [
                {'fill1': '#FF1493' /* Pink */, 'fill2': '#FFFFF1'/* White */}
            ]

        },
        {
            CentralPulseRect: [
                {
                    "fill1": "#FFFF00", /* Yellow */
                    "fill2": "#1560BD" /* Blue */
                }
            ]
        }
        ,
        {                            /*CANTERBURY TACTIX*/
            CanterburyTactixRect: [
                {
                    "fill1": '#FF0000', /* Red */
                    "fill2": '#000000'/* Black */
                }
            ]
        },
        {                            /* MELB VIX*/
            MelbourneVixensRect: [
                {
                    "fill1": '#191970', /* Dark Blue */
                    "fill2": '#008080'/* Green */
                }
            ]
        },
        {                            /*NSW SWIFTS*/
            NewSouthWalesSwiftsRect: [
                {
                    "fill1": '#FF0000', /*Red*/
                    "fill2": '#6495ED'/*Light Blue*/
                }
            ]
        },
        {                            /*NORTHERN MYSTICS*/
            NorthernMysticsRect: [
                {
                    "fill1": '#0000FF', /* Royal Blue */
                    "fill2": '#FF0000'/* Red */
                }
            ]
        },
        {                            /*QUEENSLAND FIREBIRDS*/
            QueenslandFirebirdsRect: [
                {
                    "fill1": '#800080', /* Purple */
                    "fill2": '#FFA500'/* Gold */
                }
            ]
        },
        {                            /*SOUTHERN STEEL*/
            SouthernSteelRect: [
                {
                    "fill1": '#00B7EB', /* Light Blue*/
                    "fill2": '#000000'/*Black*/
                }
            ]
        },
        {                            /*WAIKATO BAY OF PLENTY MAGIC*/
            WaikatoBayofPlentyMagicRect: [
                {
                    "fill1": '#000000', /* Black */
                    "fill2": '#FF4500'/* Orange */
                }
            ]
        },
        {                            /*WESTCOST FEVER*/
            WestCoastFeverRect: [
                {
                    "fill1": '#000000', /* Black */
                    "fill2": '#32CD32'/* Bright Ugly Green*/
                }
            ]}
    ];
 var teamNames = [
        "Adelaide Thunderbirds",
        "Central Pulse" ,
        "Canterbury Tactix",
        "Melbourne Vixens",
        "New South Wales Swifts",
        "Northern Mystics",
        "Queensland Firebirds",
        "Southern Steel",
        "Waikato Bay of Plenty Magic",
        "West Coast Fever"
    ];
var svgLeft = d3.select("#svgCell1")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("transform", "translate(" + baseTransX + "," + height/2.5 + ")");

    var svgRight = d3.select("#svgCell1")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("transform", "translate(" + (baseTransX) + "," + height/2.5+ ")");




//BEGIN MAIN FUNCTION

    //PIE ONE HOME
    /////////////////////////////////////////////////////////////////
    d3.json("data/allSeasons.json", function (data) {
        var homeSelector = "Home";
        var winLossLeft = getWinLoss(homeSelector );
 console.log(winLossLeft);

        var arcLeft = d3.svg.arc()
                .innerRadius(pieInnerRadius)
                .outerRadius(pieRadius);


        var pieLeft = d3.layout.pie()
                .value(function (d) {
                    return d.count;
                });

        var pieDataLeft = pieLeft(winLossLeft);
// console.log(pieData);

        var arcsLeft = svgLeft.selectAll("g.arc")
                .data(pieDataLeft)
                .enter()
                .append("g")
                .attr("class", "arc")

                .on("click", function (d) {
                    return showResultsDetails(d, d.data);
                });
        arcsLeft.append("path")
                .attr("fill", function (d, i) {
                    return colorScale(i);
                })
                .attr("d", arcLeft);
        arcsLeft.append("text")
                .attr("transform", function (d) {
                    return "translate(" + arcLeft.centroid(d) + ")";
                })
                .attr("fill", "#FFFFFF")
                .attr("text-anchor", "middle")
                .text(function (d) {
// console.log(d.data.label);
                    return "Home "+ d.data.label + " : " + d.data.count;
                });
        //PIE ONE
        /////////////////////////////////////////////////////////////////


        /////////////////////////////////////////////////////////////////
        var awaySelecter = "Away";
        var winLossRight = getWinLoss(awaySelecter);
        console.log(winLossRight);

        var arcRight = d3.svg.arc()
                .innerRadius(pieInnerRadius)
                .outerRadius(pieRadius);


        var pieRight = d3.layout.pie()
                .value(function (d) {
                    return d.count;
                });

        var pieDataRight = pieRight(winLossRight);
// console.log(pieData);

        var arcsRight = svgRight.selectAll("g.arc")
                .data(pieDataRight)
                .enter()
                .append("g")
                .attr("class", "arc")
                .on("click", function (d) {
                    return showResultsDetails(d, d.data);
                });
        arcsRight.append("path")
                .attr("fill", function (d, i) {
                    return colorScale(i);
                })
                .attr("d", arcRight);

        arcsRight.append("text")
                .attr("transform", function (d) {
                    return "translate(" + arcRight.centroid(d) + ")";
                })
                .attr("fill", "#FFFFFF")
                .attr("text-anchor", "middle")
                .text(function (d) {
// console.log(d.data.label);
                    return "Away " + d.data.label + " : " + d.data.count;
                });
        //PIE ONE
        /////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////


//BEGIN RESULTS FUNCTION
        function showResultsDetails(inputData, record){

            d3.json("data/allSeasons.json",function(data){
                // console.log(record);
                var season = data.seasons[0][record.year];
                svgLeft.selectAll("g.arc").remove();
                var boxGroup = svgLeft.append("g").attr("id","boxGroup");
                var gameGroup = svgLeft.append("g").attr("id","gameGroup");

                if(record.label === "Won"){
                    var box =	boxGroup.selectAll("rect")
                            .data(season)

                            .enter()
                            .append("rect")
                            .filter(function(d){
                                return (d.winner === feverTeamName);
                            })
                            .attr("x", 100)
                            .attr("y", height/8)
                            .attr("width", width/2)
                            .attr("height", height/2)
                            .attr("fill", function(d, i){
                                return colorScale(i);
                            });
                    var games = gameGroup.selectAll("circle")
                            .data(season)
                            .enter()
                            .append("circle")
                            .filter(function(d){return d.winner == feverTeamName;})
                            .attr("cx", function(d,i){
                                // if(d.round == season){
                                console.log(i)
                                return 250 +( i*200);
                                // }
                            })
                            .attr("cy", function(d,i){
                                // if(d.round == season){
                                return height /2;
                                // }
                            })
                            .attr("r", function(d,i){
                                // if(d.round == season){
                                return d.winnerScore;
                                // }
                            })
                            .attr("class", function(d){
                                // if(d.round == season){
                                var winner = d.winner;
                                console.log(stripSpaces(winner,"Circle"))
                                return stripSpaces(winner,"Circle");
                                // }
                            }).append("text", function(d){
                                return d.winner + " : " + d.winnerScore+ " - " + d.loserScore + " : " + d.loser;
                            });




                    console.log(record.label);

                }
                else if(record.label === "Lost"){
                    console.log(record.label);
                }



            });
        }
        //END RESULTS FUNCTION

//BEGINS WINLOSS FUNCTION
        function getWinLoss(homeAway){
            var seasonWinLoss = [];

            var winCount = 0;
            var lossCount= 0;
            var insertDex=0;
            var seasons = data.seasons[0];

            if (homeAway === "Home") {
                for (var i = 1; i > 0; i--) {
                    var season = seasons[year];
                    for (var x = season.length - 1; x >= 0; x--) {
                        if (season[x].homeTeam == feverTeamName) {
                            if (season[x].winner === feverTeamName) {
                                winCount += 1;
                            }
                            else if (season[x].loser === feverTeamName) {
                                lossCount += 1;
                            }
                        }

                    }
                    ;
                    var seasonWinOutCome = {
                       "TeamName":feverTeamName, "year": year, "label": "Wins", "count": winCount
                    };
                    var seasonLossOutCome = {
                        "TeamName":feverTeamName, "year": year, "label": "Losses", "count": lossCount
                    };
                    seasonWinLoss[insertDex] = seasonWinOutCome;
                    seasonWinLoss[insertDex + 1] = seasonLossOutCome;
                    insertDex += 2;
                    // year+=1;
                    winCount = 0;
                    lossCount = 0;
                }
            } else if (homeAway === "Away" ) {


                for (var i = 1; i > 0; i--) {
                    var season = seasons[year];
                    for (var x = season.length - 1; x >= 0; x--) {
                        if (season[x].awayTeam == feverTeamName) {
                            if (season[x].winner === feverTeamName) {
                                winCount += 1;
                            }
                            else if (season[x].loser === feverTeamName) {
                                lossCount += 1;
                            }
                        }

                    }
                    ;
                    var seasonWinOutCome = {
                        "year": year, "label": "Wins", "count": winCount
                    };
                    var seasonLossOutCome = {
                        "year": year, "label": "Losses", "count": lossCount
                    };
                    seasonWinLoss[insertDex] = seasonWinOutCome;
                    seasonWinLoss[insertDex + 1] = seasonLossOutCome;
                    insertDex += 2;
                    // year+=1;
                    winCount = 0;
                    lossCount = 0;
                }





            }

            return seasonWinLoss;
        }
//ENDS WINLOSS FUNCTION


        function change() {
             var newWinLossLeft = getWinLoss(homeSelector);
            var newpieDataLeft = pieLeft(newWinLossLeft);
                 arcsLeft.selectAll("g.arc")
                    .data(newWinLossLeft)
            arcsLeft.selectAll("path")
                    .attr("fill", function (d, i) {
                        return colorScale(i);
                    })
                    .attr("d", arcLeft);





//           arcsLeft.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
        }





        function arcTween(a) {
            var i = d3.interpolate(this._current, a);
            this._current = i(0);
            return function(t) {
                return arc(i(t));
            };
        }






//SLIDER
        d3.select('#slider1').call(d3.slider().axis(d3.svg.axis().ticks(5)).min(2008).max(2013).step(1).on("slide",function(evt, value){
            year = value;
            change();
            console.log("Current Year"+year);
        }));


    });
//END MAIN FUNCTION




</script>

<!--<div id="slider1" class="wrapper"></div>-->

</body>
</html>