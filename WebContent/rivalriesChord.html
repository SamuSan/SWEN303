<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>

    <link rel="stylesheet" href="styles/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/d3.slider.css">


</head>

<body>


<script type="text/javascript" src="d3/d3.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="d3Functions.js"></script>
<script type="text/javascript" src="js/d3slider/d3.slider.js"></script>
<script type="text/javascript">

//var width = 800;
//var height = 700;

function stripQuotes(str) {
    var s = str.replace(/\"/g, '');
    return s;
}
var teamNames = [
    "Adelaide Thunderbirds",
    "Central Pulse" ,
    "Canterbury Tactix",
    "Melbourne Vixens",
    "New South Wales Swifts",
    "Northern Mystics",
    "Queensland Firebirds",
    "Southern Steel",
    "Waikato Bay of Plenty Magic",
    "West Coast Fever"
];
//var currTeam = stripQuotes(document.getElementById("teamSelector").options[0].value);
//console.log("Initialised team = " + currTeam);
var offSet = 30;
var barWidth = 80;
var factor = 20;
var teamColors = [
    {
        AdelaideThunderbirdsRect: [
            {'fill1': '#FF1493' /* Pink */, 'fill2': '#FFFFF1'/* White */}
        ]

    },
    {
        CentralPulseRect: [
            {
                "fill1": "#FFFF00", /* Yellow */
                "fill2": "#1560BD" /* Blue */
            }
        ]
    }
    ,
    {                            /*CANTERBURY TACTIX*/
        CanterburyTactixRect: [
            {
                "fill1": '#FF0000', /* Red */
                "fill2": '#000000'/* Black */
            }
        ]
    },
    {                            /* MELB VIX*/
        MelbourneVixensRect: [
            {
                "fill1": '#191970', /* Dark Blue */
                "fill2": '#008080'/* Green */
            }
        ]
    },
    {                            /*NSW SWIFTS*/
        NewSouthWalesSwiftsRect: [
            {
                "fill1": '#FF0000', /*Red*/
                "fill2": '#6495ED'/*Light Blue*/
            }
        ]
    },
    {                            /*NORTHERN MYSTICS*/
        NorthernMysticsRect: [
            {
                "fill1": '#0000FF', /* Royal Blue */
                "fill2": '#FF0000'/* Red */
            }
        ]
    },
    {                            /*QUEENSLAND FIREBIRDS*/
        QueenslandFirebirdsRect: [
            {
                "fill1": '#800080', /* Purple */
                "fill2": '#FFA500'/* Gold */
            }
        ]
    },
    {                            /*SOUTHERN STEEL*/
        SouthernSteelRect: [
            {
                "fill1": '#00B7EB', /* Light Blue*/
                "fill2": '#000000'/*Black*/
            }
        ]
    },
    {                            /*WAIKATO BAY OF PLENTY MAGIC*/
        WaikatoBayofPlentyMagicRect: [
            {
                "fill1": '#000000', /* Black */
                "fill2": '#FF4500'/* Orange */
            }
        ]
    },
    {                            /*WESTCOST FEVER*/
        WestCoastFeverRect: [
            {
                "fill1": '#000000', /* Black */
                "fill2": '#32CD32'/* Bright Ugly Green*/
            }
        ]}
];
var color = d3.scale.category20();


//MAIN BEGIN

d3.json("data/allSeasons.json", function (data) {


var rivData = getRivals();
    console.log(rivData);


    var matrix = [
        [11975,  5871, 8916, 2868],
        [ 1951, 10048, 2060, 6171],
        [ 8010, 16145, 8090, 8045],
        [ 1013,   990,  940, 6907]
    ];





    var chord = d3.layout.chord()
            .padding(.05)
            .sortSubgroups(d3.descending)
            .matrix(rivData);

    var width = 960,
            height = 500,
            innerRadius = Math.min(width, height) * .41,
            outerRadius = innerRadius * 1.1;

    var fill = d3.scale.ordinal()
            .domain(d3.range(4))
            .range(["#000000", "#FFDD89", "#957244", "#F26223"]);

    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    svg.append("g").selectAll("path")
            .data(chord.groups)
            .enter().append("path")
            .style("fill", function(d) { return fill(d.index); })
            .style("stroke", function(d) { return fill(d.index); })
            .attr("d", d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius))
            .on("mouseover", fade(.1))
            .on("mouseout", fade(1));

    var ticks = svg.append("g").selectAll("g")
            .data(chord.groups)
            .enter().append("g").selectAll("g")
            .data(groupTicks)
            .enter().append("g")
            .attr("transform", function(d) {
                return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                        + "translate(" + outerRadius + ",0)";
            });

    ticks.append("line")
            .attr("x1", 1)
            .attr("y1", 0)
            .attr("x2", 5)
            .attr("y2", 0)
            .style("stroke", "#000");

    ticks.append("text")
            .attr("x", 8)
            .attr("dy", ".35em")
            .attr("transform", function(d) { return d.angle > Math.PI ? "rotate(180)translate(-16)" : null; })
            .style("text-anchor", function(d) {
                console.log(d.index);
                return d.angle > Math.PI ? "end" : null; })
            .text(function(d) { return d.label; });

    svg.append("g")
            .attr("class", "chord")
            .selectAll("path")
            .data(chord.chords)
            .enter().append("path")
            .attr("d", d3.svg.chord().radius(innerRadius))
            .style("fill", function(d) { return fill(d.target.index); })
            .style("opacity", 1);

// Returns an array of tick angles and labels, given a group.
    function groupTicks(d) {
        var k = (d.endAngle - d.startAngle) / d.value;
        return d3.range(0, d.value, 1000).map(function(v, i) {
            return {
                angle: v * k + d.startAngle,

                label: i % 5 ? null : v / 1000 + "k"
            };
        });
    }

// Returns an event handler for fading a given chord group.
    function fade(opacity) {
        return function(g, i) {
            svg.selectAll(".chord path")
                    .filter(function(d) { return d.source.index != i && d.target.index != i; })
                    .transition()
                    .style("opacity", opacity);
        };
    }






























    function getRivals() {

        var graph = [[],[],[],[],[],[],[],[],[],[]];


        var idxY = 0;
        var idxX = 0;
        for (var team in teamNames) {

            for (var team2 in teamNames) {
//                if () {
                    var year = +2008;
                    var winCount = 0;
                    var lossCount = 0;

                    for (var i = 5; i >= 0; i--) {
                        var season = data["seasons"][0][year];
                        for (var x = season.length - 1; x >= 0; x--) {
                            if (season[x].winner === teamNames[team] && season[x].loser === teamNames[team2]) {
                                winCount += 1;
                            }
                            else if (season[x].winner === teamNames[team2] && season[x].loser === teamNames[team]) {

                                lossCount += 1;
                            }
                        }
                        year += 1;
                    }
                if (teamNames[team] !== teamNames[team2]) {
                    graph[idxY][idxX] = +(winCount / (winCount + lossCount) * 100);
                }
                else{
                    graph[idxY][idxX] =0;
                }
                    idxX+=1;
//                }
                winCount = 0;
                lossCount = 0;

            }
            idxY+=1;
            idxX=0;
        }
        return graph;

    }
});
//END MAIN

function getIndex(name) {
    return teamNames.indexOf(name);
}


</script>
</body>
</html>