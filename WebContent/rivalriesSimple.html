<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head>

    <link rel="stylesheet" href="styles/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/d3.slider.css">


</head>

<body>


<script type="text/javascript" src="d3/d3.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="d3Functions.js"></script>
<script type="text/javascript" src="js/d3slider/d3.slider.js"></script>
<div class="sexyMainDiv">
<select id="teamSelector" class="dropdown-menu-left">
    <option> "Adelaide Thunderbirds"</option>
    <option> "Melbourne Vixens"</option>
    <option> "Central Pulse"</option>
    <option> "Queensland Firebirds"</option>
    <option> "Waikato Bay of Plenty Magic"</option>
    <option> "Southern Steel"</option>
    <option> "New South Wales Swifts"</option>
    <option> "Northern Mystics"</option>
    <option> "West Coast Fever"</option>
    <option> "Canterbury Tactix"</option>
</select>

<table>
<tr>
<td></td>
<td id="barSvgCell">
<script type="text/javascript">

var width = 800;
var height = 700;

function stripQuotes(str) {
    var s = str.replace(/\"/g, '');
    return s;
}
var teamNames = [
    "Adelaide Thunderbirds",
    "Central Pulse" ,
    "Canterbury Tactix",
    "Melbourne Vixens",
    "New South Wales Swifts",
    "Northern Mystics",
    "Queensland Firebirds",
    "Southern Steel",
    "Waikato Bay of Plenty Magic",
    "West Coast Fever"
];
var currTeam = stripQuotes(document.getElementById("teamSelector").options[0].value);
console.log("Initialised team = " + currTeam);
var offSet = 30;
var barWidth = 80;
var factor = 20;
var teamColors = [
    {
        AdelaideThunderbirdsRect: [
            {'fill1': '#FF1493' /* Pink */, 'fill2': '#FFFFF1'/* White */}
        ]

    },
    {
        CentralPulseRect: [
            {
                "fill1": "#FFFF00", /* Yellow */
                "fill2": "#1560BD" /* Blue */
            }
        ]
    }
    ,
    {                            /*CANTERBURY TACTIX*/
        CanterburyTactixRect: [
            {
                "fill1": '#FF0000', /* Red */
                "fill2": '#000000'/* Black */
            }
        ]
    },
    {                            /* MELB VIX*/
        MelbourneVixensRect: [
            {
                "fill1": '#191970', /* Dark Blue */
                "fill2": '#008080'/* Green */
            }
        ]
    },
    {                            /*NSW SWIFTS*/
        NewSouthWalesSwiftsRect: [
            {
                "fill1": '#FF0000', /*Red*/
                "fill2": '#6495ED'/*Light Blue*/
            }
        ]
    },
    {                            /*NORTHERN MYSTICS*/
        NorthernMysticsRect: [
            {
                "fill1": '#0000FF', /* Royal Blue */
                "fill2": '#FF0000'/* Red */
            }
        ]
    },
    {                            /*QUEENSLAND FIREBIRDS*/
        QueenslandFirebirdsRect: [
            {
                "fill1": '#800080', /* Purple */
                "fill2": '#FFA500'/* Gold */
            }
        ]
    },
    {                            /*SOUTHERN STEEL*/
        SouthernSteelRect: [
            {
                "fill1": '#00B7EB', /* Light Blue*/
                "fill2": '#000000'/*Black*/
            }
        ]
    },
    {                            /*WAIKATO BAY OF PLENTY MAGIC*/
        WaikatoBayofPlentyMagicRect: [
            {
                "fill1": '#000000', /* Black */
                "fill2": '#FF4500'/* Orange */
            }
        ]
    },
    {                            /*WESTCOST FEVER*/
        WestCoastFeverRect: [
            {
                "fill1": '#000000', /* Black */
                "fill2": '#32CD32'/* Bright Ugly Green*/
            }
        ]}
];
var svg = d3.select("#barSvgCell")
        .append("svg")
        .attr("width", width)
        .attr("height", height);
        // .attr("transform", "translate(100,50)");
var rivContainer = svg.append("g");
var force = d3.layout.force()
        .charge(-500)
        .linkDistance(500)
        .size([width, height]);
var color = d3.scale.category20();

defs = svg.append("svg:defs");
defs.append('svg:pattern')
        .attr('id', 'AdelaideThunderbirdsImage')
        .attr('patternUnits', 'objectBoundingBox')
        .attr('width', 1)
        .attr('height', 1)
        .append('svg:image')
        .attr('xlink:href', 'http://i59.tinypic.com/e9xjk2.jpg')
        .attr('x', 0    )
        .attr('y', 0)
        .attr('width', 200)
        .attr('height', 200);

//MAIN BEGIN

d3.json("data/allSeasons.json", function (data) {

    console.log(data);

    var rivalsGraphData = getRivals(data);
    //BEGIN MAIN

currContainer = svg.append("g");
    currContainer.append('circle')
            .attr("cx", width /3)
            .attr("cy", height/2)
            .attr("r", 100)
            .attr("class", function(d){
                var name = stripSpaces(currTeam, "Circle");

                return name;
            });

    currContainer.append('circle')
            .attr("cx", width /3)
            .attr("cy", height/2)
            .attr("r", 100)
//            .attr("class", function(d){
//                var name = stripSpaces(currTeam, "Circle");
//
//                return name;
//            })
            .attr("fill","url(#AdelaideThunderbirdsImage)");


















    //END MAIN










    //Selector
    d3.select("#teamSelector").on("change", function () {
        console.log("DOINGFUCKING CHANGE BULLSHIT");
        var sel = document.getElementById("teamSelector");
        var name = stripQuotes(sel.options[sel.selectedIndex].value);
        currTeam = name;
        console.log(currTeam);
    });
    ///Selecter


    function getRivals(data) {

        var graph = [];




        var linkIdx = 0;


            for (var team2 in teamNames) {
                if (currTeam !== teamNames[team2]) {
                    var year = +2008;
                    var winCount = 0;
                    var lossCount = 0;

                    for (var i = 5; i >= 0; i--) {
                        var season = data["seasons"][0][year];
                        for (var x = season.length - 1; x >= 0; x--) {
                            if (season[x].winner === currTeam && season[x].loser === teamNames[team2]) {
                                winCount += 1;
                            }
                            else if (season[x].winner === teamNames[team2] && season[x].loser === currTeam) {

                                lossCount += 1;
                            }
                        }
                        year += 1;
                    }

                }
                if (lossCount === 0) {
                    var linkStrength = winCount / (winCount + lossCount);
                } else {
                    var linkStrength = lossCount / (winCount + lossCount);
                }
                    if(linkStrength < 0.5){
                        linkStrength = Math.round(((linkStrength*10)*3));
                    }
                    else{
                        linkStrength =Math.round(((1-linkStrength)*10)*3) ;
                    }
                if (currTeam !== teamNames[team2]) {
                    graph.push({"source": currTeam, "target": teamNames[team2], "value": linkStrength});
                }
                winCount = 0;
                lossCount = 0;

            }

graph = graph.sort(function(a,b){
    return a.value < b.value;
})
        return graph;

    }
});
//END MAIN

function getIndex(name) {
    return teamNames.indexOf(name);
}


</script>
</td>
<td>
    <div id="gamesDiv">
    </div>
</td>
</tr>
</table>
</div>
</body>
</html>